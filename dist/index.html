<!DOCTYPE html>
<!--
 *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
-->
<html>
<head>

  <meta charset="utf-8">
  <meta name="description" content="WebRTC code samples">
  <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
  <meta itemprop="description" content="Client-side WebRTC code samples">
  <meta itemprop="image" content="../../../images/webrtc-icon-192x192.png">
  <meta itemprop="name" content="WebRTC code samples">
  <meta name="mobile-web-app-capable" content="yes">
  <meta id="theme-color" name="theme-color" content="#ffffff">

  <base target="_blank">

  <title>Peer connection: audio only</title>

  <link rel="icon" sizes="192x192" href="../../../images/webrtc-icon-192x192.png">
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../../../css/main.css" />
  <link rel="stylesheet" href="css/main.css" />

</head>

<body>

  <div id="container">

    <h1><a href="//webrtc.github.io/samples/" title="WebRTC samples homepage">WebRTC samples</a></h1>
    <h4><span>Peer connection: audio only</span></h4>

    <div id="create_room">
      Room name : <input type="text" id="room_name" value=""/>
      <button id="btn_room_create">join</button>
    </div>
    <div id="standby" style="display:none">

    </div>
    <div id="voice_talk" style="display:none">
      <div id="audio">
        <div>
          <div class="label">Local :</div><video id="audio1" autoplay controls muted></video>
        </div>
        <div>
          <div class="label">Remote :</div><video id="audio2" autoplay controls></video>
        </div>
      </div>

      <div id="buttons">
        <select id="codec">
          <!-- Codec values are matched with how they appear in the SDP.
          For instance, opus matches opus/48000/2 in Chrome, and ISAC/16000
          matches 16K iSAC (but not 32K iSAC). -->
          <option value="ISAC">iSAC 16K</option>
          <option value="opus">Opus</option>
          <option value="G722">G722</option>
          <option value="PCMU">PCMU</option>
        </select>
        <button id="callButton">Call</button>
        <button id="hangupButton">Hang Up</button>
      </div>
      <div class="graph-container" id="bitrateGraph">
        <div>Bitrate</div>
        <canvas id="bitrateCanvas"></canvas>
      </div>
      <div class="graph-container" id="packetGraph">
        <div>Packets sent per second</div>
        <canvas id="packetCanvas"></canvas>
      </div>
    </div>
<br/><br/>
    <!--a href="https://github.com/webrtc/samples/tree/gh-pages/src/content/peerconnection/audio" title="View source for this page on GitHub" id="viewSource">View source on GitHub</a-->
    <p id='server-time'></p>
  </div>

  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <script src="js/common.js"></script>
  <script src="js/main.js"></script>
  <script src="js/third_party/graph.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>
  <script>
      var socket = io.connect();
      /*var el = document.getElementById('server-time');
      socket.on('create_room', function(timeString) {
        el.innerHTML = 'Server time: ' + timeString;
      });*/
      socket.on('request.offer', function() {
        //offer create
        area_standby.style.display = '';
        area_talk.style.display = '';
        call();
      });
      socket.on('offer', function(data) {
        //receive offer
          var signal = JSON.parse(data);
          if (signal.sdp) {
            call(signal);
          }
          area_standby.style.display = '';
          area_talk.style.display = '';
      });
      socket.on('answer', function(data) {
        //receive offer
          var signal = JSON.parse(data);
          if (signal.sdp) {
            gotRemoteDescription(signal);
          }
      });
      socket.on('candidate', function(data) {
        //receive offer
          if (data) {
            addIcecandidate(data);
          }
      });
      var area_create = document.getElementById('create_room');
      var area_standby = document.getElementById('standby');
      var area_talk = document.getElementById('voice_talk');
      var btn = document.getElementById('btn_room_create');
      var room_name = document.getElementById('room_name');

      btn.addEventListener('click', function(e) {
        socket.emit('joinRoom', room_name.value, function (data) {
          area_standby.innerHTML = '<p> join room : ' + room_name.value + '</p>'
                                  + (data == 'waiting' ? '<p>Waiting for other users</p>' : 'Waiting for offer');
          area_create.style.display = 'none';
          area_standby.style.display = '';
        });
      }, false);
    </script>
</body>
</html>
